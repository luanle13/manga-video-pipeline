{% extends "base.html" %}

{% block title %}Processed Manga - Manga Video Pipeline{% endblock %}

{% block content %}
<h1>Processed Manga</h1>

<div class="card">
    <p style="color: #666; margin-bottom: 1.5rem;">
        Browse all manga that have been successfully processed through the pipeline.
        These manga will not be re-processed automatically.
    </p>

    <!-- Manga Table -->
    <table id="manga-table">
        <thead>
            <tr>
                <th>Manga Title</th>
                <th>Manga ID</th>
                <th>Processed Date</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="3" style="text-align: center; padding: 2rem;">Loading...</td>
            </tr>
        </tbody>
    </table>

    <div id="totalCount" style="margin-top: 1rem; color: #666;"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Load processed manga from the processed_manga table
    async function loadManga() {
        try {
            const response = await fetch('/api/processed-manga?limit=100', {
                credentials: 'include'
            });

            if (!response.ok) {
                throw new Error('Failed to load manga');
            }

            const data = await response.json();
            const tbody = document.querySelector('#manga-table tbody');

            if (data.items.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #666;">No processed manga found</td></tr>';
                document.getElementById('totalCount').textContent = '';
                return;
            }

            tbody.innerHTML = data.items.map(manga => `
                <tr>
                    <td><strong>${manga.title}</strong></td>
                    <td><code>${truncateId(manga.manga_id)}</code></td>
                    <td>${formatDateTime(manga.processed_at)}</td>
                </tr>
            `).join('');

            document.getElementById('totalCount').textContent = `Total: ${data.total} manga processed`;
        } catch (error) {
            console.error('Error loading manga:', error);
            const tbody = document.querySelector('#manga-table tbody');
            tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: var(--danger);">Error loading data</td></tr>';
        }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        loadManga();
    });
</script>
{% endblock %}
